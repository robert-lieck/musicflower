<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Extract Data &mdash; musicflower  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/autoclasstoc.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery-rendered-html.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Summary" href="../api_summary.html" />
    <link rel="prev" title="Basic Example" href="plot_basic_example.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> musicflower
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">MusicFlower Gallery</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="plot_time_traces.html">Time Traces</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_basic_example.html">Basic Example</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Extract Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#loading-files">Loading Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#colours-and-3d-coordinates">Colours and 3D Coordinates</a></li>
<li class="toctree-l3"><a class="reference internal" href="#triangular-surface">Triangular Surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#time-traces">Time Traces</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api_summary.html">API Summary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">musicflower</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">MusicFlower Gallery</a> &raquo;</li>
      <li>Extract Data</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-examples-plot-extract-data-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="extract-data">
<span id="sphx-glr-auto-examples-plot-extract-data-py"></span><h1>Extract Data<a class="headerlink" href="#extract-data" title="Permalink to this headline"></a></h1>
<p>The relevant data can be extracted as described below, for instance, if a different visualisation backend than Plotly
should be used (see <a class="reference internal" href="plot_basic_example.html"><span class="doc">Basic Example</span></a> for basic functionality).</p>
<section id="loading-files">
<h2>Loading Files<a class="headerlink" href="#loading-files" title="Permalink to this headline"></a></h2>
<p>There are some options for loading files. First, the <a class="reference internal" href="../_autosummary/musicflower.loader.load_file.html#musicflower.loader.load_file" title="musicflower.loader.load_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_file()</span></code></a> function
provides a number of parameters. Second, the <a class="reference internal" href="../_autosummary/musicflower.loader.load_corpus.html#musicflower.loader.load_corpus" title="musicflower.loader.load_corpus"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_corpus()</span></code></a> function can be used
to parallelise loading of multiple files (see documentation for more details). Here, we simply load the same file
twice, parallelise loading, and cache results (subsequent runs of this script will reuse the cached
result from the first run). The resulting corpus corresponds to a concatenation of the outputs generated by the
<a class="reference internal" href="../_autosummary/musicflower.loader.load_file.html#musicflower.loader.load_file" title="musicflower.loader.load_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_file()</span></code></a> function with the number of files as its first dimension. Note that the
<cite>file_paths</cite> (and scapes in the corpus) may have a different order than the input <cite>file_paths</cite> (see documentation of
<a class="reference internal" href="../_autosummary/musicflower.loader.load_corpus.html#musicflower.loader.load_corpus" title="musicflower.loader.load_corpus"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_corpus()</span></code></a> for details).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">musicflower.loader</span> <span class="kn">import</span> <span class="n">load_corpus</span>
<span class="n">file_path</span> <span class="o">=</span> <span class="s1">&#39;Prelude_No._1_BWV_846_in_C_Major.mxl&#39;</span>
<span class="n">resolution</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">corpus</span><span class="p">,</span> <span class="n">file_paths</span> <span class="o">=</span> <span class="n">load_corpus</span><span class="p">(</span>
    <span class="n">file_paths</span><span class="o">=</span><span class="p">[</span><span class="n">file_path</span><span class="p">,</span> <span class="n">file_path</span><span class="p">],</span>
    <span class="n">n</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
    <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">use_cache</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">corpus</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/2 [00:00&lt;?, ?it/s]
 50%|#####     | 1/2 [00:00&lt;00:00,  1.73it/s]
100%|##########| 2/2 [00:00&lt;00:00,  3.45it/s]
(2, 1275, 12)
</pre></div>
</div>
</section>
<section id="colours-and-3d-coordinates">
<h2>Colours and 3D Coordinates<a class="headerlink" href="#colours-and-3d-coordinates" title="Permalink to this headline"></a></h2>
<p>These data can be mapped to colours and 3D coordinates as shown in the <a class="reference internal" href="plot_basic_example.html"><span class="doc">Basic Example</span></a>, that is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">musicflower.plotting</span> <span class="kn">import</span> <span class="n">key_colors</span>
<span class="kn">from</span> <span class="nn">musicflower.util</span> <span class="kn">import</span> <span class="n">get_fourier_component</span><span class="p">,</span> <span class="n">remap_to_xyz</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">key_colors</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">remap_to_xyz</span><span class="p">(</span><span class="o">*</span><span class="n">get_fourier_component</span><span class="p">(</span><span class="n">pcds</span><span class="o">=</span><span class="n">corpus</span><span class="p">,</span> <span class="n">fourier_component</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>(2, 1275, 3)
(2, 1275)
</pre></div>
</div>
</section>
<section id="triangular-surface">
<h2>Triangular Surface<a class="headerlink" href="#triangular-surface" title="Permalink to this headline"></a></h2>
<p>The points in 3D space define a triangular surface, which corresponds the surface shown in a key scape plot “folded
and wrapped” in 3D space. The point indices of the respective triangles can be obtained with the
<a class="reference internal" href="../_autosummary/musicflower.util.surface_scape_indices.html#musicflower.util.surface_scape_indices" title="musicflower.util.surface_scape_indices"><code class="xref py py-func docutils literal notranslate"><span class="pre">surface_scape_indices()</span></code></a> function. The resolution can either be explicitly specified or via an
array dimension.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">musicflower.util</span> <span class="kn">import</span> <span class="n">surface_scape_indices</span>
<span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">surface_scape_indices</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># from array dimension</span>
<span class="n">i_</span><span class="p">,</span> <span class="n">j_</span><span class="p">,</span> <span class="n">k_</span> <span class="o">=</span> <span class="n">surface_scape_indices</span><span class="p">(</span><span class="n">resolution</span><span class="p">)</span>   <span class="c1"># from resolution</span>
<span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="p">[</span><span class="n">i_</span><span class="p">,</span> <span class="n">j_</span><span class="p">,</span> <span class="n">k_</span><span class="p">])</span>          <span class="c1"># result is the same</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
<p>The triangle with a specific index can be obtained as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">piece</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1st vertex (i):&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">piece</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="n">idx</span><span class="p">]],</span> <span class="n">y</span><span class="p">[</span><span class="n">piece</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="n">idx</span><span class="p">]],</span> <span class="n">z</span><span class="p">[</span><span class="n">piece</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="n">idx</span><span class="p">]])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2nd vertex (j):&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">piece</span><span class="p">,</span> <span class="n">j</span><span class="p">[</span><span class="n">idx</span><span class="p">]],</span> <span class="n">y</span><span class="p">[</span><span class="n">piece</span><span class="p">,</span> <span class="n">j</span><span class="p">[</span><span class="n">idx</span><span class="p">]],</span> <span class="n">z</span><span class="p">[</span><span class="n">piece</span><span class="p">,</span> <span class="n">j</span><span class="p">[</span><span class="n">idx</span><span class="p">]])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3rd vertex (k):&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">piece</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="n">idx</span><span class="p">]],</span> <span class="n">y</span><span class="p">[</span><span class="n">piece</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="n">idx</span><span class="p">]],</span> <span class="n">z</span><span class="p">[</span><span class="n">piece</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="n">idx</span><span class="p">]])</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>1st vertex (i): 1.016927877403892 0.7426998034456703 0.5644950789161737
2nd vertex (j): 1.0026452680541686 0.7305989113488145 0.5572501208474614
3rd vertex (k): 0.9955507901181573 0.737470906059694 0.560905773736201
</pre></div>
</div>
<p>or, more compactly, by concatenating coordinates and indices and using NumPy’s advanced indexing</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ijk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">i</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">j</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="n">piece</span><span class="p">,</span> <span class="n">ijk</span><span class="p">[</span><span class="n">idx</span><span class="p">]])</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[[1.01692788 0.7426998  0.56449508]
 [1.00264527 0.73059891 0.55725012]
 [0.99555079 0.73747091 0.56090577]]
</pre></div>
</div>
</section>
<section id="time-traces">
<h2>Time Traces<a class="headerlink" href="#time-traces" title="Permalink to this headline"></a></h2>
<p>In <a class="reference internal" href="plot_basic_example.html"><span class="doc">Basic Example</span></a> the time traces were plotted, but we did not extract the actual data for them.
They are computed by interpolating along rows of the triangular map using the
<a class="reference internal" href="../_autosummary/musicflower.util.time_traces.html#musicflower.util.time_traces" title="musicflower.util.time_traces"><code class="xref py py-func docutils literal notranslate"><span class="pre">time_traces()</span></code></a> function. In the output, the first dimension are time steps, the second runs
along the traces (from the top of the triangle to the bottom), and the last one are xyz-coordinates or RGB-colours,
respectively. The third (batch) dimension are the different pieces in this case.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">musicflower.util</span> <span class="kn">import</span> <span class="n">time_traces</span>
<span class="n">xyz_traces</span><span class="p">,</span> <span class="n">colors_traces</span> <span class="o">=</span> <span class="n">time_traces</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">n_steps</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">xyz_traces</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">colors_traces</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>(201, 50, 2, 3) (201, 50, 2, 3)
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  0.668 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-plot-extract-data-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/5d90592a4b17a3016615068ea0c40015/plot_extract_data.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_extract_data.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/a499ce84646ebeb42dba720ee90c6650/plot_extract_data.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_extract_data.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="plot_basic_example.html" class="btn btn-neutral float-left" title="Basic Example" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../api_summary.html" class="btn btn-neutral float-right" title="API Summary" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Robert Lieck.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>