

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Spectral Dome: Extract Data &mdash; MusicFlower  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
      <link rel="stylesheet" type="text/css" href="../_static/autoclasstoc.css?v=08871587" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Spectral Dome: Stand-Alone Example" href="plot_spectral_dome_example.html" />
    <link rel="prev" title="Time Traces" href="plot_time_traces.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: black" >

          
          
          <a href="../index.html" class="icon icon-home">
            MusicFlower
              <img src="../_static/logo_96.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">MusicFlower Gallery</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="plot_triangular_maps.html">Triangular Maps</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_time_traces.html">Time Traces</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Spectral Dome: Extract Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#loading-files">Loading Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#colours-and-3d-coordinates">Colours and 3D Coordinates</a></li>
<li class="toctree-l3"><a class="reference internal" href="#triangular-surface">Triangular Surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#time-traces">Time Traces</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="plot_spectral_dome_example.html">Spectral Dome: Stand-Alone Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_webapp.html">WebApp Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api_summary.html">API Summary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MusicFlower</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">MusicFlower Gallery</a></li>
      <li class="breadcrumb-item active">Spectral Dome: Extract Data</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/robert-lieck/musicflower/blob/main/doc/auto_examples/plot_spectral_dome_extract_data.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-examples-plot-spectral-dome-extract-data-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="spectral-dome-extract-data">
<span id="sphx-glr-auto-examples-plot-spectral-dome-extract-data-py"></span><h1>Spectral Dome: Extract Data<a class="headerlink" href="#spectral-dome-extract-data" title="Link to this heading"></a></h1>
<p>The relevant data can be extracted from the Spectral Dome representation as described below, for instance,
if a different visualisation backend than Plotly should be used (see <a class="reference internal" href="plot_spectral_dome_example.html"><span class="doc">Spectral Dome: Stand-Alone Example</span></a> for basic
functionality).</p>
<section id="loading-files">
<h2>Loading Files<a class="headerlink" href="#loading-files" title="Link to this heading"></a></h2>
<p>There are some options for loading files. First, the <a class="reference internal" href="../_autosummary/musicflower.loader.load_file.html#musicflower.loader.load_file" title="musicflower.loader.load_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_file()</span></code></a> function
provides a number of parameters. Second, the <a class="reference internal" href="../_autosummary/musicflower.loader.load_corpus.html#musicflower.loader.load_corpus" title="musicflower.loader.load_corpus"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_corpus()</span></code></a> function can be used
to parallelise loading of multiple files (see documentation for more details). Here, we simply load the same file
twice, parallelise loading, and cache results (subsequent runs of this script will reuse the cached
result from the first run). The resulting corpus corresponds to a concatenation of the outputs generated by the
<a class="reference internal" href="../_autosummary/musicflower.loader.load_file.html#musicflower.loader.load_file" title="musicflower.loader.load_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_file()</span></code></a> function with the number of files as its first dimension. Note that the
<cite>file_paths</cite> (and scapes in the corpus) may have a different order than the input <cite>file_paths</cite> (see documentation of
<a class="reference internal" href="../_autosummary/musicflower.loader.load_corpus.html#musicflower.loader.load_corpus" title="musicflower.loader.load_corpus"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_corpus()</span></code></a> for details).</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">musicflower.loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_corpus</span>
<span class="n">file_path</span> <span class="o">=</span> <span class="s1">&#39;Prelude_No._1_BWV_846_in_C_Major.mxl&#39;</span>
<span class="n">resolution</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">corpus</span><span class="p">,</span> <span class="n">file_paths</span> <span class="o">=</span> <span class="n">load_corpus</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">file_path</span><span class="p">,</span> <span class="n">file_path</span><span class="p">],</span>
    <span class="n">n</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
    <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">use_cache</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">corpus</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/2 [00:00&lt;?, ?it/s]
 50%|█████     | 1/2 [00:00&lt;00:00,  1.57it/s]
100%|██████████| 2/2 [00:00&lt;00:00,  3.15it/s]
(2, 1275, 12)
</pre></div>
</div>
</section>
<section id="colours-and-3d-coordinates">
<h2>Colours and 3D Coordinates<a class="headerlink" href="#colours-and-3d-coordinates" title="Link to this heading"></a></h2>
<p>These data can be mapped to colours and 3D coordinates as shown in the <a class="reference internal" href="plot_spectral_dome_example.html"><span class="doc">Spectral Dome: Stand-Alone Example</span></a>, that is</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">musicflower.plotting</span><span class="w"> </span><span class="kn">import</span> <span class="n">key_colors</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">musicflower.util</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_fourier_component</span><span class="p">,</span> <span class="n">remap_to_xyz</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">key_colors</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">remap_to_xyz</span><span class="p">(</span><span class="o">*</span><span class="n">get_fourier_component</span><span class="p">(</span><span class="n">pcds</span><span class="o">=</span><span class="n">corpus</span><span class="p">,</span> <span class="n">fourier_component</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>(2, 1275, 3)
(2, 1275)
</pre></div>
</div>
</section>
<section id="triangular-surface">
<h2>Triangular Surface<a class="headerlink" href="#triangular-surface" title="Link to this heading"></a></h2>
<p>The points in 3D space define a triangular surface, which corresponds the surface shown in a key scape plot “folded
and wrapped” in 3D space. The point indices of the respective triangles can be obtained with the
<a class="reference internal" href="../_autosummary/musicflower.util.surface_scape_indices.html#musicflower.util.surface_scape_indices" title="musicflower.util.surface_scape_indices"><code class="xref py py-func docutils literal notranslate"><span class="pre">surface_scape_indices()</span></code></a> function. The resolution can either be explicitly specified or via an
array dimension.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">musicflower.util</span><span class="w"> </span><span class="kn">import</span> <span class="n">surface_scape_indices</span>
<span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">surface_scape_indices</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># from array dimension</span>
<span class="n">i_</span><span class="p">,</span> <span class="n">j_</span><span class="p">,</span> <span class="n">k_</span> <span class="o">=</span> <span class="n">surface_scape_indices</span><span class="p">(</span><span class="n">resolution</span><span class="p">)</span>   <span class="c1"># from resolution</span>
<span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="p">[</span><span class="n">i_</span><span class="p">,</span> <span class="n">j_</span><span class="p">,</span> <span class="n">k_</span><span class="p">])</span>          <span class="c1"># result is the same</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
<p>The triangle with a specific index can be obtained as</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">piece</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1st vertex (i):&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">piece</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="n">idx</span><span class="p">]],</span> <span class="n">y</span><span class="p">[</span><span class="n">piece</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="n">idx</span><span class="p">]],</span> <span class="n">z</span><span class="p">[</span><span class="n">piece</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="n">idx</span><span class="p">]])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2nd vertex (j):&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">piece</span><span class="p">,</span> <span class="n">j</span><span class="p">[</span><span class="n">idx</span><span class="p">]],</span> <span class="n">y</span><span class="p">[</span><span class="n">piece</span><span class="p">,</span> <span class="n">j</span><span class="p">[</span><span class="n">idx</span><span class="p">]],</span> <span class="n">z</span><span class="p">[</span><span class="n">piece</span><span class="p">,</span> <span class="n">j</span><span class="p">[</span><span class="n">idx</span><span class="p">]])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3rd vertex (k):&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">piece</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="n">idx</span><span class="p">]],</span> <span class="n">y</span><span class="p">[</span><span class="n">piece</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="n">idx</span><span class="p">]],</span> <span class="n">z</span><span class="p">[</span><span class="n">piece</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="n">idx</span><span class="p">]])</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>1st vertex (i): 0.884285110785993 0.6458259160397136 0.490865286014064
2nd vertex (j): 0.869942217870529 0.6339019966114718 0.48349642838235596
3rd vertex (k): 0.86378671495546 0.6398644626106169 0.48666824485935084
</pre></div>
</div>
<p>or, more compactly, by concatenating coordinates and indices and using NumPy’s advanced indexing</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ijk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">i</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">j</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="n">piece</span><span class="p">,</span> <span class="n">ijk</span><span class="p">[</span><span class="n">idx</span><span class="p">]])</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[[0.88428511 0.64582592 0.49086529]
 [0.86994222 0.633902   0.48349643]
 [0.86378671 0.63986446 0.48666824]]
</pre></div>
</div>
</section>
<section id="time-traces">
<h2>Time Traces<a class="headerlink" href="#time-traces" title="Link to this heading"></a></h2>
<p>In <a class="reference internal" href="plot_spectral_dome_example.html"><span class="doc">Spectral Dome: Stand-Alone Example</span></a> the time traces were plotted, but we did not extract the actual data for them.
They are computed by interpolating along rows of the triangular map using the
<a class="reference internal" href="../_autosummary/musicflower.util.get_time_traces.html#musicflower.util.get_time_traces" title="musicflower.util.get_time_traces"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_time_traces()</span></code></a> function. In the output, the first dimension are time steps, the second runs
along the traces (from the top of the triangle to the bottom), and the last one are xyz-coordinates or RGB-colours,
respectively. The third (batch) dimension are the different pieces in this case.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">musicflower.util</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_time_traces</span>
<span class="n">xyz_traces</span><span class="p">,</span> <span class="n">colors_traces</span> <span class="o">=</span> <span class="n">get_time_traces</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">n_steps</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">xyz_traces</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">colors_traces</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>(201, 50, 2, 3) (201, 50, 2, 3)
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 1.178 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-plot-spectral-dome-extract-data-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/afc5800fb801b8298af592e588294767/plot_spectral_dome_extract_data.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_spectral_dome_extract_data.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/021ded31477e6c2b0b127ccd4077bf3f/plot_spectral_dome_extract_data.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_spectral_dome_extract_data.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../_downloads/e7ee26808dde55bea8c6c3f93b594ab0/plot_spectral_dome_extract_data.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">plot_spectral_dome_extract_data.zip</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="plot_time_traces.html" class="btn btn-neutral float-left" title="Time Traces" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="plot_spectral_dome_example.html" class="btn btn-neutral float-right" title="Spectral Dome: Stand-Alone Example" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Robert Lieck.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>